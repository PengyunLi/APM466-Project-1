install.packages("jrvFinance")
install.packages("rootSolve")


library(jrvFinance)
library(rootSolve)


#Question 4a

settle = c("2020-01-02", "2020-01-03","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10",
           "2020-01-13", "2020-01-14", "2020-01-15")

mature = c("2020-03-01","2020-09-01", "2021-03-01", "2021-09-01", "2022-03-01", 
            "2023-03-01","2024-03-01", "2024-09-01", "2025-03-01")


coupon = c(0.0150,0.0075,0.0075,0.0075,0.0050,0.0175,0.0225,0.0150,0.0125)

#The followings are the closing prices for the 10 bonds chosen.
l <- list()
b1 = c(99.85,	99.86	,99.86,	99.86,	99.86,	99.86,	99.86	,99.86,	99.86	,99.86)
b2 = c(99.26,	99.28	,99.28,	99.27	,99.28	,99.28	,99.28	,99.27,	99.28	,99.30)
b3 = c(98.89,	98.93,	98.95,	98.94,	98.92,	98.92,	98.88,	98.90,	98.90,	98.93)
b4 = c(98.41,	98.45,	98.49,	98.46,	98.46,	98.43,	98.43,	98.38,	98.41,	98.42)
b5 = c(97.57,	97.63,	97.66,	97.65,	97.64,	97.60,	97.61,	97.57,	97.58,	97.61)
b6 = c(98.94,	99.03,	99.07,	99.05,	99.04,	98.98,	98.96,	98.92,	98.95,	99.00)
b7 = c(100.31,	100.42,	100.48,	100.45,	100.44,	100.35,	100.31, 100.27,	100.31,	100.38)
b8 = c(101.42,	101.54,	101.62,	101.52,	101.56,	101.44,	101.39,	101.37,	101.43,	101.51)
b9 = c(102.52,	102.65,	102.75,	102.58,	102.68,	102.53,	102.47,	102.46,	102.54,	102.64)
b10 = c(98.72,	98.95,	99.29,	99.11,	99.25,	98.99,	99.03,	99.06,	98.99,	99.10)
b11 = c(98.24,	98.43,	98.58,	98.48,	98.48,	98.30,	98.25,	98.24,	98.34,	98.47)

l <- list(b1,b2,b3,b4,b5,b7,b9,b10,b11)

#l <- c(b1,b2,b3,b4,b5,b6,b7,b8,b9,b10)
matrix <- do.call(rbind, l)
  
matrix

# calculate each of your 10 selected bondsâ€™ yield for each day
ytm_per_day <- 0


for (j in 1:10){

        for(i in 1: 9) {
          ytm_per_day[i] <- bond.yield(settle=settle[j], mature=mature[i], freq = 2,comp.freq = Inf,coupon=coupon[i], price=matrix[i,j],
                               redemption_value = 100)
        }
  print(ytm_per_day)
}  

d1_ytm = c(0.02406730, 0.01867487, 0.01709712, 0.01715870, 0.01640878,(0.01640878 +0.01642020)/2, 0.01642020,(0.01642020+ 0.01614895)/2,
           0.01614895, 0.01779154,0.01599983)
d2_ytm = c(0.02360272, 0.01841697, 0.01677094, 0.01692910, 0.01613774,(0.01613774 +0.01606464)/2, 0.01606464,
           (0.01606464 +0.01582810)/2,0.01582810, 0.01727821,0.01561627)
d3_ytm = c(0.02407196, 0.01855629, 0.01666209, 0.01672966, 0.01603737,(0.01603737+ 0.01586739)/2, 0.01586739, ( 0.01586739+ 0.01557167)/2,
           0.01557167, 0.01652193,0.01531702)
d4_ytm = c(0.02424001, 0.01875854, 0.01677226, 0.01693055, 0.01609939,(0.01609939 +0.01596306)/2, 0.01596306,(0.01596306+ 0.01598249)/2,
           0.01598249, 0.01692530,0.01552139)
d5_ytm = c(0.02441442, 0.01865118, 0.01697130, 0.01694640, 0.01616158,(0.01616158+ 0.01599419)/2, 0.01599419,(0.01599419+ 0.01573399)/2,
           0.01573399, 0.01661320,0.01552300)
d6_ytm = c(0.02459557, 0.01869923, 0.01699425, 0.01714840, 0.01636784,(0.01636784 +0.01628463)/2, 0.01628463,(0.01628463+ 0.01609676)/2,
           0.01609676, 0.01719664,0.01589068)
d7_ytm = c(0.02478384, 0.01874771, 0.01737237, 0.01716467, 0.01633449,(0.01633449 +0.01641349)/2, 0.01641349, (0.01641349 +0.01623981)/2, 
           0.01623981, 0.01710820,0.015994358)
d8_ytm = c(0.02539588, 0.01905478, 0.01726601, 0.01752619, 0.01657150, (0.01657150+ 0.01654117)/2, 0.01654117, (0.01654117+ 0.01625265)/2,
           0.01625265, 0.01704460, 0.01602035)
d9_ytm = c(0.02561731, 0.01894590, 0.01728997, 0.01735545, 0.01653823,(0.01653823 +0.01641012)/2, 0.01641012, (0.01641012 +0.01605218)/2,
           0.01605218, 0.01720326, 0.01581811)
d10_ytm = c(0.02584839, 0.01867563, 0.01704453, 0.01730954, 0.01640818, (0.01640818+ 0.01618115)/2, 0.01618115, (0.01618115+ 0.01580251)/2,
            0.01580251, 0.01695711, 0.01555471)


d  <- list(d1_ytm,d2_ytm,d3_ytm,d4_ytm,d5_ytm,d6_ytm,d7_ytm,d8_ytm,d9_ytm,d10_ytm)

matrix2 <- do.call(rbind, d)

matrix2

#the year-fraction for each issue day is:

for (i in 1:10){
  yf= bond.TCF(settle[i],mature[9],freq=2,coupon = coupon[i],redemption_value = 100)$t
  # yf[i]= bond.TCF(settle[j],mature[i],coupon[i],freq=2,redemption_value = 100)$t
  print(yf)
}

yf_1 = c(0.1638889, 0.6638889, 1.1638889, 1.6638889, 2.1638889, 2.6638889, 3.1638889, 3.6638889, 4.1638889
         ,4.6638889, 5.1638889)
yf_2 = c(0.1611111, 0.6611111, 1.1611111, 1.6611111, 2.1611111, 2.6611111, 3.1611111, 3.6611111, 4.1611111,
         4.6611111, 5.1611111)
yf_3 = c(0.1527778, 0.6527778, 1.1527778, 1.6527778, 2.1527778, 2.6527778, 3.1527778, 3.6527778, 4.1527778
         ,4.6527778, 5.1527778)
yf_4 = c(0.15, 0.65, 1.15 ,1.65, 2.15 ,2.65, 3.15 ,3.65, 4.15, 4.65 ,5.15)
yf_5 = c(0.1472222, 0.6472222, 1.1472222, 1.6472222, 2.1472222, 2.6472222, 3.1472222 ,3.6472222, 4.1472222
         ,4.6472222, 5.1472222)
yf_6 = c(0.1444444, 0.6444444, 1.1444444 ,1.6444444, 2.1444444, 2.6444444 ,3.1444444, 3.6444444, 4.1444444
         ,4.6444444, 5.1444444)
yf_7 = c(0.1416667 ,0.6416667, 1.1416667, 1.6416667 ,2.1416667, 2.6416667, 3.1416667, 3.6416667, 4.1416667
         ,4.6416667, 5.1416667)
yf_8 = c(0.1333333, 0.6333333, 1.1333333 ,1.6333333, 2.1333333, 2.6333333, 3.1333333, 3.6333333, 4.1333333,
         4.6333333, 5.1333333)
yf_9 = c(0.1305556, 0.6305556, 1.1305556, 1.6305556, 2.1305556, 2.6305556, 3.1305556, 3.6305556, 4.1305556,
         4.6305556 ,5.1305556)
yf_10 = c(0.1277778, 0.6277778 ,1.1277778, 1.6277778, 2.1277778, 2.6277778, 3.1277778, 3.6277778, 4.1277778
          ,4.6277778, 5.1277778)


plot(yf_1,d1_ytm, type = "l", col = "blue", xlab = "YearFraction", ylab = "YTM", ylim = c(0.015,0.026))
col = c("red","grey","yellow","green","black","purple","orange","pink", "brown")
lines(yf_2,d2_ytm,  col = col[1], type = "l")
lines(yf_3,d3_ytm,  col = col[2], type = "l")
lines(yf_4,d4_ytm,  col = col[3], type = "l")
lines(yf_5,d5_ytm,  col = col[4], type = "l")
lines(yf_6,d6_ytm,  col = col[5], type = "l")
lines(yf_7,d7_ytm,  col = col[6], type = "l")
lines(yf_8,d8_ytm,  col = col[7], type = "l")
lines(yf_9,d9_ytm,  col = col[8], type = "l")
lines(yf_10,d10_ytm,  col = col[9], type = "l")

# Add a legend to the plot
legend("topright", legend=c("day1", "day2","day3","day4","day5","day6","day7","day8","day9","day10"),
       col=c("blue", "red","grey","yellow","green","black","purple","orange","pink", "brown"), lty = 1:2, cex=0.8)


#Question 4b

#To find spot yield, we need to find dirty price, year fraction, and cash flow.


dp <- as.matrix(dp)
cf <- list()
yf <- list()
for (j in 1:10){
  for (i in 1:9){
  dp[i] = bond.TCF(settle[j],mature[i],coupon[i],freq=2)$accrued + matrix[i,j]
#  cf[i]= bond.TCF(settle[j],mature[i],coupon[i],freq=2,redemption_value = 100)$cf
 # yf[i]= bond.TCF(settle[j],mature[i],coupon[i],freq=2,redemption_value = 100)$t
  } 
  print(do.call(rbind, dp))
}
# so arrange them we get dp for each day for b1-11 excluding b6,b8 (need to estimate them using interpolation).
  dp_1 = c(100.35417,99.51208,99.14208,98.66208,97.73806,100.89819,103.27625,99.22417,98.66014)
  dp_2 = c(100.36833,99.53417,99.18417,98.70417,97.79944,101.01306,103.41250,99.45833,98.85361)
  dp_3 = c(100.38083,99.54042,99.21042,98.75042,97.83361,101.08764,103.53125,99.81083,99.01403)
  dp_4 = c(100.3850,99.5325,99.2025,98.7225,97.8250,101.0625,103.3675,99.6350,98.9175)
  dp_5 = c(100.38917,99.54458,99.18458,98.72458,97.81639,101.05736,103.47375,99.77917,98.92097)
  dp_6 = c(100.39333,99.54667,99.18667,98.69667,97.77778,100.97222,103.33000,99.52333,98.74444)
  dp_7 = c(100.39750,99.54875,99.14875,98.69875,97.78917,100.93708,103.27625,99.56750,98.69792)
  dp_8 = c(100.41000,99.54500,99.17500,98.65500,97.75333,100.91167,103.28500,99.61000,98.69833)
  dp_9 = c(100.41417,99.55708,99.17708,98.68708,97.76472,100.95653,103.37125, 99.54417,98.80181)
  dp_10 = c(100.41833,99.57917,99.20917,98.69917,97.79611,101.03139,103.47750,99.65833,98.93528)



#so the cash flow for the 9 bonds are
  
for (i in 1:9){
    cf= bond.TCF(settle[i],mature[i],coupon[i],freq=2,redemption_value = 100)$cf
      # yf[i]= bond.TCF(settle[j],mature[i],coupon[i],freq=2,redemption_value = 100)$t
    print(cf)
  }

  
cf_1 = c(100.75)
cf_2 = c(0.375, 100.375)
cf_3 = c(0.375,   0.375, 100.375)
cf_4 = c(0.375,   0.375,   0.375, 100.375)
cf_5 = c(0.25,   0.25,   0.25,   0.25, 100.25)
cf_7 = c(0.875,   0.875,   0.875,   0.875,   0.875,   0.875, 100.875)
cf_9 = c(1.125 ,  1.125,   1.125,   1.125,   1.125,   1.125,   1.125,   1.125, 101.125)
cf_10 = c(0.75,   0.75 ,  0.75 ,  0.75,   0.75 ,  0.75  , 0.75 ,  0.75,   0.75, 100.75)
cf_11 = c(0.625 ,  0.625 ,  0.625,   0.625,   0.625 ,  0.625  , 0.625,   0.625,   0.625 ,  0.625, 100.625)


# spot yield for day1

cf = c(cf_1,cf_2,cf_3,cf_4,cf_5,cf_7,cf_9,cf_10,cf_11)

f_1 = function(x) dp_1[1] - cf_1[1]*exp(-(yf_1[1]*x))
s_1 = uniroot(f_1,c(0,0.03))$root
s_1

f_2 = function(x) dp_1[2] - cf_2[1]*exp(-yf_1[1]*s_1)- cf_2[2]*exp(-yf_1[2]*x)
s_2 = uniroot(f_2,c(0,0.03))$root
s_2

f_3 = function(x) dp_1[3] - cf_3[1]*exp(-yf_1[1]*s_1)- cf_3[2]*exp(-yf_1[2]*s_2)-
  cf_3[3]*exp(-yf_1[3]*x)
s_3 = uniroot(f_3,c(0,0.03))$root
s_3

f_4 = function(x) dp_1[4] - cf_4[1]*exp(-yf_1[1]*s_1)- cf_4[2]*exp(-yf_1[2]*s_2)-
  cf_4[3]*exp(-yf_1[3]*s_3) - cf_4[4]*exp(-yf_1[4]*x)
s_4 = uniroot(f_4,c(0,0.03))$root
s_4

f_5 = function(x) dp_1[5] - cf_5[1]*exp(-yf_1[1]*s_1)- cf_5[2]*exp(-yf_1[2]*s_2)-
  cf_5[3]*exp(-yf_1[3]*s_3) - cf_5[4]*exp(-yf_1[4]*s_4) - cf_5[5]*exp(-yf_1[5]*x)
s_5 = uniroot(f_5,c(0,0.03))$root
s_5


s_6 = s_4 + (s_5 - s_4)*((yf_all[1,6] - yf_all[1,4])/(yf_all[1,5]-yf_all[1,4]))
s_6
#s_6 = 2*s_5-s_4
#s_6

f_7 = function(x) dp_1[6] - cf_7[1]*exp(-yf_1[1]*s_1)- cf_7[2]*exp(-yf_1[2]*s_2)-
  cf_7[3]*exp(-yf_1[3]*s_3) - cf_7[4]*exp(-yf_1[4]*s_4) - cf_7[5]*exp(-yf_1[5]*s_5) -cf_7[6]*exp(-yf_1[6]*s_6)-cf_7[7]*exp(-yf_1[7]*x)
s_7 = uniroot(f_7,c(0,0.03))$root
s_7

s_8 = s_6 + (s_7 - s_6)*((yf_all[1,8] - yf_all[1,6])/(yf_all[1,7]-yf_all[1,6]))
s_8
  
f_9 = function(x) dp_1[7] - cf_9[1]*exp(-yf_1[1]*s_1)- cf_9[2]*exp(-yf_1[2]*s_2)-
cf_9[3]*exp(-yf_1[3]*s_3) - cf_9[4]*exp(-yf_1[4]*s_4) - cf_9[5]*exp(-yf_1[5]*s_5) -cf_9[6]*exp(-yf_1[6]*s_6)-cf_9[7]*exp(-yf_1[7]*s_7)-cf_9[8]*exp(-yf_1[8]*s_8)-cf_9[9]*exp(-yf_1[9]*x)
s_9 = uniroot(f_9,c(0,0.03))$root
s_9  
  
f_10 = function(x) dp_1[8] - cf_10[1]*exp(-yf_1[1]*s_1)- cf_10[2]*exp(-yf_1[2]*s_2)-
  cf_10[3]*exp(-yf_1[3]*s_3) - cf_10[4]*exp(-yf_1[4]*s_4) - cf_10[5]*exp(-yf_1[5]*s_5) -cf_10[6]*exp(-yf_1[6]*s_6)-cf_10[7]*exp(-yf_1[7]*s_7)-cf_10[8]*exp(-yf_1[8]*s_8)-cf_10[9]*exp(-yf_1[9]*s_9) - cf_10[10]*exp(-yf_1[10]*x)
s_10 = uniroot(f_10,c(0,0.03))$root
s_10  

f_11 = function(x) dp_1[9] - cf_11[1]*exp(-yf_1[1]*s_1)- cf_11[2]*exp(-yf_1[2]*s_2)-
  cf_11[3]*exp(-yf_1[3]*s_3) - cf_11[4]*exp(-yf_1[4]*s_4) - cf_11[5]*exp(-yf_1[5]*s_5) -cf_11[6]*exp(-yf_1[6]*s_6)-cf_11[7]*exp(-yf_1[7]*s_7)-cf_11[8]*exp(-yf_1[8]*s_8)-cf_11[9]*exp(-yf_1[9]*s_9) - cf_11[10]*exp(-yf_1[10]*s_10) - cf_11[11]*exp(-yf_1[11]*x)
s_11 = uniroot(f_11,c(0,0.03))$root
s_11

d1_s = c(s_1, s_2, s_3,s_4, s_5, s_6,s_7, s_8, s_9,s_10, s_11)
d1_s

plot(yf_1,d1_s, type = "l", col = "blue", xlab = "YearFraction", ylab = "Spot Yield", ylim = c(0.015,0.026))

# spot yield for day2 - 10

dp_all = c(dp_1,dp_2,dp_3,dp_4,dp_5,dp_6,dp_7,dp_8,dp_9,dp_10)
dp_all
yf_all = rbind(yf_1,yf_2,yf_3,yf_4,yf_5,yf_6,yf_7,yf_8,yf_9,yf_10)
col = c("red","grey","yellow","green","black","purple","orange","pink", "brown")


for (i in 2:10){
  # spot yield for day2
  
  f_1 = function(x) dp_all[9*(i-1)+1]- cf_1[1]*exp(-(yf_all[i,][1]*x))
  s_1 = uniroot(f_1,c(0,0.03))$root
  s_1
  
  f_2 = function(x) dp_all[9*(i-1)+2]- cf_2[1]*exp(-yf_all[i,][1]*s_1)- cf_2[2]*exp(-yf_all[i,][2]*x)
  s_2 = uniroot(f_2,c(0,0.03))$root
  s_2
  
  f_3 = function(x) dp_all[9*(i-1)+3] - cf_3[1]*exp(-yf_all[i,][1]*s_1)- cf_3[2]*exp(-yf_all[i,][2]*s_2)-
    cf_3[3]*exp(-yf_all[i,][3]*x)
  s_3 = uniroot(f_3,c(0,0.03))$root
  s_3
  
  f_4 = function(x) dp_all[9*(i-1)+4] - cf_4[1]*exp(-yf_all[i,][1]*s_1)- cf_4[2]*exp(-yf_all[i,][2]*s_2)-
    cf_4[3]*exp(-yf_all[i,][3]*s_3) - cf_4[4]*exp(-yf_all[i,][4]*x)
  s_4 = uniroot(f_4,c(0,0.03))$root
  s_4
  
  f_5 = function(x) dp_all[9*(i-1)+5] - cf_5[1]*exp(-yf_all[i,][1]*s_1)- cf_5[2]*exp(-yf_all[i,][2]*s_2)-
    cf_5[3]*exp(-yf_all[i,][3]*s_3) - cf_5[4]*exp(-yf_all[i,][4]*s_4) - cf_5[5]*exp(-yf_all[i,][5]*x)
  s_5 = uniroot(f_5,c(0,0.03))$root
  s_5
  
  
  s_6 = s_4 + (s_5 - s_4)*((yf_all[i,][6] - yf_all[i,][4])/(yf_all[i,][5]-yf_all[i,][4]))
  s_6

  
  f_7 = function(x) dp_all[9*(i-1)+6] - cf_7[1]*exp(-yf_all[i,][1]*s_1)- cf_7[2]*exp(-yf_all[i,][2]*s_2)-
    cf_7[3]*exp(-yf_all[i,][3]*s_3) - cf_7[4]*exp(-yf_all[i,][4]*s_4) - cf_7[5]*exp(-yf_all[i,][5]*s_5) -cf_7[6]*exp(-yf_all[i,][6]*s_6)-cf_7[7]*exp(-yf_all[i,][7]*x)
  s_7 = uniroot(f_7,c(0,0.03))$root
  s_7
  
  s_8 = s_6 + (s_7 - s_6)*((yf_all[i,][8] - yf_all[i,][6])/(yf_all[i,][7]-yf_all[i,][6]))
  s_8

  
  f_9 = function(x) dp_all[9*(i-1)+7] - cf_9[1]*exp(-yf_all[i,][1]*s_1)- cf_9[2]*exp(-yf_all[i,][2]*s_2)-
    cf_9[3]*exp(-yf_all[i,][3]*s_3) - cf_9[4]*exp(-yf_all[i,][4]*s_4) - cf_9[5]*exp(-yf_all[i,][5]*s_5) -cf_9[6]*exp(-yf_all[i,][6]*s_6)-cf_9[7]*exp(-yf_all[i,][7]*s_7)-cf_9[8]*exp(-yf_all[i,][8]*s_8)-cf_9[9]*exp(-yf_all[i,][9]*x)
  s_9 = uniroot(f_9,c(0,0.03))$root
  s_9  
  
  f_10 = function(x) dp_all[9*(i-1)+8] - cf_10[1]*exp(-yf_all[i,][1]*s_1)- cf_10[2]*exp(-yf_all[i,][2]*s_2)-
    cf_10[3]*exp(-yf_all[i,][3]*s_3) - cf_10[4]*exp(-yf_all[i,][4]*s_4) - cf_10[5]*exp(-yf_all[i,][5]*s_5) -cf_10[6]*exp(-yf_all[i,][6]*s_6)-cf_10[7]*exp(-yf_all[i,][7]*s_7)-cf_10[8]*exp(-yf_all[i,][8]*s_8)-cf_10[9]*exp(-yf_all[i,][9]*s_9) - cf_10[10]*exp(-yf_all[i,][10]*x)
  s_10 = uniroot(f_10,c(0,0.03))$root
  s_10  
  
  f_11 = function(x) dp_all[9*(i-1)+9] - cf_11[1]*exp(-yf_all[i,][1]*s_1)- cf_11[2]*exp(-yf_all[i,][2]*s_2)-
    cf_11[3]*exp(-yf_all[i,][3]*s_3) - cf_11[4]*exp(-yf_all[i,][4]*s_4) - cf_11[5]*exp(-yf_all[i,][5]*s_5) -cf_11[6]*exp(-yf_all[i,][6]*s_6)-cf_11[7]*exp(-yf_all[i,][7]*s_7)-cf_11[8]*exp(-yf_all[i,][8]*s_8)-cf_11[9]*exp(-yf_all[i,][9]*s_9) - cf_11[10]*exp(-yf_all[i,][10]*s_10) - cf_11[11]*exp(-yf_all[i,][11]*x)
  s_11 = uniroot(f_11,c(0,0.03))$root
  s_11
  
  d_s = c(s_1, s_2, s_3,s_4, s_5, s_6,s_7, s_8, s_9,s_10, s_11)
  print(d_s)
  
  lines(yf_all[i,],d_s,  col = col[i], type = "l")
  
}
legend("topright", legend=c("day1", "day2","day3","day4","day5","day6","day7","day8","day9","day10"),
       col=c("blue", "red","grey","yellow","green","black","purple","orange","pink", "brown"), lty = 1:2, cex=0.8)

f_9 = function(x) dp_all[9*(8-1)+7] - cf_9[1]*exp(-yf_all[7,1]*s_1)- cf_9[2]*exp(-yf_all[7,2]*s_2)-
  cf_9[3]*exp(-yf_all[8,][3]*s_3) - cf_9[4]*exp(-yf_all[8,][4]*s_4) - cf_9[5]*exp(-yf_all[8,5]*s_5) -cf_9[6]*exp(-yf_all[7,][6]*s_6)-cf_9[7]*exp(-yf_all[7,][7]*s_7)-cf_9[8]*exp(-yf_all[7,][8]*s_8)-cf_9[9]*exp(-yf_all[7,][9]*x)
s_9 = uniroot(f_9,c(0,0.03))$root
s_9  

sd1 = c(0.02403152, 0.01866994, 0.01709005, 0.01715398 ,0.01640305 ,0.01565212, 0.01641224,
        0.01717236, 0.01612205 ,0.01782786, 0.01597301)
sd2 = c(0.02357038, 0.01841219, 0.01676379, 0.01692477, 0.01613210, 0.01533944, 0.01605509,
        0.01677074,0.01580159, 0.01730849, 0.01558887)
sd3 = c(0.02403898, 0.01855140, 0.01665431, 0.01672448, 0.01603172, 0.01533896, 0.01585487,
        0.01637078,0.01554179 ,0.01653404, 0.01528975)
sd4 = c(0.02420658, 0.01875380 ,0.01676435, 0.01692569, 0.01609331, 0.01526093, 0.01595134,
        0.01664176,0.01596483, 0.01694449, 0.01549351)
sd5 = c(0.02438052, 0.01864631 ,0.01696415 ,0.01694126, 0.01615555, 0.01536983, 0.01598153,
        0.01659322,0.01570452, 0.01662325, 0.01549765)
sd6 = c(0.02456187, 0.01869423, 0.01698698, 0.01714397, 0.01636221, 0.01558045, 0.01627491,
        0.01696937,0.01607236, 0.01721681 ,0.01586648)
sd7 = c(0.02474964, 0.01874271, 0.01736598, 0.01715926 ,0.01632814, 0.01549702, 0.01640624,
        0.01731547,0.01621629, 0.01712146, 0.01597071)
sd8 = c(0.02536083, 0.01904978, 0.01725862, 0.01752217 ,0.01656539 ,0.01560862, 0.01653277,
        0.01745693,0.01622315, 0.01705180 ,0.01599490)
sd9 = c(0.02558168, 0.01894078, 0.01728288, 0.01735078, 0.01653235, 0.01571393, 0.01639900,
       0.01708408,0.01601953 ,0.01721998 ,0.01578910)
sd10 = c(0.02581296, 0.01867010 ,0.01703731, 0.01730564, 0.01640238 ,0.01549911, 0.01616855,
        0.01683799,0.01576773 ,0.01697264 ,0.01552434)

s_all = rbind(sd1,sd2,sd3,sd4,sd5,sd6,sd7,sd8,sd9,sd10)

s_all


# Question 4c
#we have calculated year fractions before.

yf_1 = c(0.1638889, 0.6638889, 1.1638889, 1.6638889, 2.1638889, 2.6638889, 3.1638889, 3.6638889, 4.1638889
         ,4.6638889, 5.1638889)
yf_2 = c(0.1611111, 0.6611111, 1.1611111, 1.6611111, 2.1611111, 2.6611111, 3.1611111, 3.6611111, 4.1611111,
         4.6611111, 5.1611111)
yf_3 = c(0.1527778, 0.6527778, 1.1527778, 1.6527778, 2.1527778, 2.6527778, 3.1527778, 3.6527778, 4.1527778
         ,4.6527778, 5.1527778)
yf_4 = c(0.15, 0.65, 1.15 ,1.65, 2.15 ,2.65, 3.15 ,3.65, 4.15, 4.65 ,5.15)
yf_5 = c(0.1472222, 0.6472222, 1.1472222, 1.6472222, 2.1472222, 2.6472222, 3.1472222 ,3.6472222, 4.1472222
         ,4.6472222, 5.1472222)
yf_6 = c(0.1444444, 0.6444444, 1.1444444 ,1.6444444, 2.1444444, 2.6444444 ,3.1444444, 3.6444444, 4.1444444
         ,4.6444444, 5.1444444)
yf_7 = c(0.1416667 ,0.6416667, 1.1416667, 1.6416667 ,2.1416667, 2.6416667, 3.1416667, 3.6416667, 4.1416667
         ,4.6416667, 5.1416667)
yf_8 = c(0.1333333, 0.6333333, 1.1333333 ,1.6333333, 2.1333333, 2.6333333, 3.1333333, 3.6333333, 4.1333333,
         4.6333333, 5.1333333)
yf_9 = c(0.1305556, 0.6305556, 1.1305556, 1.6305556, 2.1305556, 2.6305556, 3.1305556, 3.6305556, 4.1305556,
         4.6305556 ,5.1305556)
yf_10 = c(0.1277778, 0.6277778 ,1.1277778, 1.6277778, 2.1277778, 2.6277778, 3.1277778, 3.6277778, 4.1277778
          ,4.6277778, 5.1277778)

yf_all = rbind(yf_1,yf_2,yf_3,yf_4,yf_5,yf_6,yf_7,yf_8,yf_9,yf_10)
yf_all[1,]



s_12 <- list()
for (i in 1: 5){
  s_12[i] = s_all[1,2*i] + ((s_all[1,2*i+1] - s_all[1,2*i])/(yf_all[1,(2*i)+1] - yf_all[1,2*i]))*(i-yf_all[1,2*i])
}

print(s_12)
#rbind(s_12)

f_12 <- list()
for (i in 1:4){
  f_12[i] = (as.numeric(s_12)[i+1]*(i+1) -as.numeric(s_12)[1]*1)/i
}
print(f_12)
rbind(f_12)

f_1 = c(0.01569047, 0.01544068 ,0.01608579, 0.01632426)


s_13 <- list()
for (i in 1: 5){
  s_13[i] = s_all[2,2*i] + ((s_all[2,2*i+1] - s_all[2,2*i])/(yf_all[2,2*i+1] - yf_all[2,2*i]))*(i-yf_all[2,2*i])
}
print(s_13)
rbind(s_13)


f_13 <- list()
for (i in 1:4){
  f_13[i] = (as.numeric(s_13[i+1])*(i+1) - as.numeric(s_13[1])*1)/i
}
print(f_13)
rbind(f_13)

f_2 = c( 0.01548009, 0.01508927 ,0.01572018, 0.01585498)

s_16 <- list()
for (i in 1: 5){
  s_16[i] = s_all[3,2*i] + ((s_all[3,2*i+1] - s_all[3,2*i])/(yf_all[3,2*i+1] - yf_all[3,2*i]))*(i-yf_all[3,2*i])
}
print(s_16)
rbind(s_16)


f_16 <- list()
for (i in 1:4){
  f_16[i] = (as.numeric(s_16[i+1])*(i+1) - as.numeric(s_16[1])*1)/i
}
print(f_16)
rbind(f_16)

f_3 = c(0.01525282, 0.01492886, 0.01531546, 0.01527894)

s_17 <- list()
for (i in 1: 5){
  s_17[i] = s_all[4,2*i] + ((s_all[4,2*i+1] - s_all[4,2*i])/(yf_all[4,2*i+1] - yf_all[4,2*i]))*(i-yf_all[4,2*i])
}
print(s_17)
rbind(s_17)


f_17 <- list()
for (i in 1:4){
  f_17[i] = (as.numeric(s_17[i+1])*(i+1) - as.numeric(s_17[1])*1)/i
}
print(f_17)
rbind(f_17)

f_4 = c(0.01532486, 0.01493573, 0.01577015, 0.01557071)

s_18 <- list()
for (i in 1: 5){
  s_18[i] = s_all[5,2*i] + ((s_all[5,2*i+1] - s_all[5,2*i])/(yf_all[5,2*i+1] - yf_all[5,2*i]))*(i-yf_all[5,2*i])
}
print(s_18)
rbind(s_18)


f_18 <- list()
for (i in 1:4){
  f_18[i] = (as.numeric(s_18[i+1])*(i+1) - as.numeric(s_18[1])*1)/i
}
print(f_18)
rbind(f_18)

f_5 = c(0.01531434, 0.0149724 ,0.01546844 ,0.01542148)

s_19 <- list()
for (i in 1: 5){
  s_19[i] = s_all[6,2*i] + ((s_all[6,2*i+1] - s_all[6,2*i])/(yf_all[6,2*i+1] - yf_all[6,2*i]))*(i-yf_all[6,2*i])
}
print(s_19)
rbind(s_19)


f_19 <- list()
for (i in 1:4){
  f_19[i] = (as.numeric(s_19[i+1])*(i+1) - as.numeric(s_19[1])*1)/i
}
print(f_19)
rbind(f_19)

f_6 = c(0.01569592, 0.01537134, 0.0159486, 0.01595067)

s_110 <- list()
for (i in 1: 5){
  s_110[i] = s_all[7,2*i] + ((s_all[7,2*i+1] - s_all[7,2*i])/(yf_all[7,2*i+1] - yf_all[7,2*i]))*(i-yf_all[7,2*i])
}
print(s_110)
rbind(s_110)


f_110 <- list()
for (i in 1:4){
  f_110[i] = (as.numeric(s_110[i+1])*(i+1) - as.numeric(s_110[1])*1)/i
}
print(f_110)
rbind(f_110)

f_7 = c(0.01537119, 0.01534491, 0.01611828, 0.01593193)

s_113 <- list()
for (i in 1: 5){
  s_113[i] = s_all[8,2*i] + ((s_all[8,2*i+1] - s_all[8,2*i])/(yf_all[8,2*i+1] - yf_all[8,2*i]))*(i-yf_all[8,2*i])
}
print(s_113)
rbind(s_113)


f_113 <- list()
for (i in 1:4){
  f_113[i] = (as.numeric(s_113[i+1])*(i+1) - as.numeric(s_113[1])*1)/i
}
print(f_113)
rbind(f_113)

f_8 = c(0.0159048, 0.01556136, 0.01615746, 0.01591186)


s_114 <- list()
for (i in 1: 5){
  s_114[i] = s_all[9,2*i] + ((s_all[9,2*i+1] - s_all[9,2*i])/(yf_all[9,2*i+1] - yf_all[9,2*i]))*(i-yf_all[9,2*i])
}
print(s_114)
rbind(s_114)


f_114 <- list()
for (i in 1:4){
  f_114[i] = (as.numeric(s_114[i+1])*(i+1) - as.numeric(s_114[1])*1)/i
}
print(f_114)
rbind(f_114)

f_9 = c(0.01577633, 0.01547229, 0.01582474 ,0.01577445)


s_115 <- list()
for (i in 1: 5){
  s_115[i] = s_all[10,2*i] + ((s_all[10,2*i+1] - s_all[10,2*i])/(yf_all[10,2*i+1] - yf_all[10,2*i]))*(i-yf_all[10,2*i])
}
print(s_115)
rbind(s_115)


f_115 <- list()
for (i in 1:4){
  f_115[i] = (as.numeric(s_115[i+1])*(i+1) - as.numeric(s_115[1])*1)/i
}
print(f_115)
rbind(f_115)

f_10 = c(0.01581185, 0.01526892, 0.01557013 ,0.01550443)


plot(1:4,f_1, type = "l", col = "blue", xlab = "YearFraction", ylab = "Forward Rate", ylim = c(0.0148,0.0166))
lines(1:4,f_2,  col = col[1], type = "l")
lines(1:4,f_3,  col = col[2], type = "l")
lines(1:4,f_4,  col = col[3], type = "l")
lines(1:4,f_5,  col = col[4], type = "l")
lines(1:4,f_6,  col = col[5], type = "l")
lines(1:4,f_7,  col = col[6], type = "l")
lines(1:4,f_8,  col = col[7], type = "l")
lines(1:4,f_9,  col = col[8], type = "l")
lines(1:4,f_10,  col = col[9], type = "l")

legend("topleft", legend=c("day1", "day2","day3","day4","day5","day6","day7","day8","day9","day10"),
       col=c("blue", "red","grey","yellow","green","black","purple","orange","pink", "brown"), lty = 1:2, cex=0.4)

#Qn5

d1_ytm = c(0.02406730, 0.01867487, 0.01709712, 0.01715870, 0.01640878,(0.01640878 +0.01642020)/2, 0.01642020,(0.01642020+ 0.01614895)/2,
           0.01614895, 0.01779154,0.01599983)
d2_ytm = c(0.02360272, 0.01841697, 0.01677094, 0.01692910, 0.01613774,(0.01613774 +0.01606464)/2, 0.01606464,
           (0.01606464 +0.01582810)/2,0.01582810, 0.01727821,0.01561627)
d3_ytm = c(0.02407196, 0.01855629, 0.01666209, 0.01672966, 0.01603737,(0.01603737+ 0.01586739)/2, 0.01586739, ( 0.01586739+ 0.01557167)/2,
           0.01557167, 0.01652193,0.01531702)
d4_ytm = c(0.02424001, 0.01875854, 0.01677226, 0.01693055, 0.01609939,(0.01609939 +0.01596306)/2, 0.01596306,(0.01596306+ 0.01598249)/2,
           0.01598249, 0.01692530,0.01552139)
d5_ytm = c(0.02441442, 0.01865118, 0.01697130, 0.01694640, 0.01616158,(0.01616158+ 0.01599419)/2, 0.01599419,(0.01599419+ 0.01573399)/2,
           0.01573399, 0.01661320,0.01552300)
d6_ytm = c(0.02459557, 0.01869923, 0.01699425, 0.01714840, 0.01636784,(0.01636784 +0.01628463)/2, 0.01628463,(0.01628463+ 0.01609676)/2,
           0.01609676, 0.01719664,0.01589068)
d7_ytm = c(0.02478384, 0.01874771, 0.01737237, 0.01716467, 0.01633449,(0.01633449 +0.01641349)/2, 0.01641349, (0.01641349 +0.01623981)/2, 
           0.01623981, 0.01710820,0.015994358)
d8_ytm = c(0.02539588, 0.01905478, 0.01726601, 0.01752619, 0.01657150, (0.01657150+ 0.01654117)/2, 0.01654117, (0.01654117+ 0.01625265)/2,
           0.01625265, 0.01704460, 0.01602035)
d9_ytm = c(0.02561731, 0.01894590, 0.01728997, 0.01735545, 0.01653823,(0.01653823 +0.01641012)/2, 0.01641012, (0.01641012 +0.01605218)/2,
           0.01605218, 0.01720326, 0.01581811)
d10_ytm = c(0.02584839, 0.01867563, 0.01704453, 0.01730954, 0.01640818, (0.01640818+ 0.01618115)/2, 0.01618115, (0.01618115+ 0.01580251)/2,
            0.01580251, 0.01695711, 0.01555471)

ytm_all = rbind(d1_ytm,d2_ytm,d3_ytm,d4_ytm,d5_ytm,d6_ytm,d7_ytm,d8_ytm,d9_ytm,d10_ytm)
ytm_all

ytm_1 <- list()
for (i in 1: 5){
  ytm_1[i] = ytm_all[1,2*i] + ((ytm_all[1,2*i+1] - ytm_all[1,2*i])/(yf_all[1,2*i+1] - yf_all[1,2*i]))*(i-yf_all[1,2*i])
}
print(ytm_1)
rbind(ytm_1)
           #1221       #1222        #1223      #1224      #1225
ytm_1=c(0.01761427, 0.01665459, 0.01641833, 0.0161934,0.01658711)

ytm_2 <- list()
for (i in 1: 5){
  ytm_2[i] = ytm_all[2,2*i] + ((ytm_all[2,2*i+1] - ytm_all[2,2*i])/(yf_all[2,2*i+1] - yf_all[2,2*i]))*(i-yf_all[2,2*i])
}
print(ytm_2)
rbind(ytm_2)
              #1321       
ytm_2 = c(0.01730133, 0.01639273, 0.01607642, 0.01586621, 0.01615178)

ytm_3 <- list()
for (i in 1: 5){
  ytm_3[i] = ytm_all[3,2*i] + ((ytm_all[3,2*i+1] - ytm_all[3,2*i])/(yf_all[3,2*i+1] - yf_all[3,2*i]))*(i-yf_all[3,2*i])
}
print(ytm_3)
rbind(ytm_3)
            #1621
ytm_3 = c(0.01724087, 0.0162489, 0.01589336, 0.01561685, 0.01568519)

ytm_4 <- list()
for (i in 1: 5){
  ytm_4[i] = ytm_all[4,2*i] + ((ytm_all[4,2*i+1] - ytm_all[4,2*i])/(yf_all[4,2*i+1] - yf_all[4,2*i]))*(i-yf_all[4,2*i])
}
print(ytm_4)
rbind(ytm_4)

ytm_4 = c(0.01736814 ,0.01634874 ,0.01598351, 0.01597958, 0.01594256)

ytm_5 <- list()
for (i in 1: 5){
  ytm_5[i] = ytm_all[5,2*i] + ((ytm_all[5,2*i+1] - ytm_all[5,2*i])/(yf_all[5,2*i+1] - yf_all[5,2*i]))*(i-yf_all[5,2*i])
}
print(ytm_5)
rbind(ytm_5)

ytm_5 = c(0.01746593, 0.01639267, 0.01601883, 0.0157723, 0.015844)

ytm_6 <- list()
for (i in 1: 5){
  ytm_6[i] = ytm_all[6,2*i] + ((ytm_all[6,2*i+1] - ytm_all[6,2*i])/(yf_all[6,2*i+1] - yf_all[6,2*i]))*(i-yf_all[6,2*i])
}
print(ytm_6)
rbind(ytm_6)

ytm_6 = c(0.0174868, 0.01659334, 0.01629665, 0.0161239, 0.01626796)

ytm_7 <- list()
for (i in 1: 5){
  ytm_7[i] = ytm_all[7,2*i] + ((ytm_all[7,2*i+1] - ytm_all[7,2*i])/(yf_all[7,2*i+1] - yf_all[7,2*i]))*(i-yf_all[7,2*i])
}
print(ytm_7)
rbind(ytm_7)

ytm_7 = c(0.01776205, 0.01656971, 0.0164023, 0.01626441, 0.01630995)

ytm_8 <- list()
for (i in 1: 5){
  ytm_8[i] = ytm_all[8,2*i] + ((ytm_all[8,2*i+1] - ytm_all[8,2*i])/(yf_all[8,2*i+1] - yf_all[8,2*i]))*(i-yf_all[8,2*i])
}
print(ytm_8)
rbind(ytm_8)

ytm_8= c(0.01774302, 0.01682608, 0.01654521, 0.01629112 ,0.01629348)

ytm_9 <- list()
for (i in 1: 5){
  ytm_9[i] = ytm_all[9,2*i] + ((ytm_all[9,2*i+1] - ytm_all[9,2*i])/(yf_all[9,2*i+1] - yf_all[9,2*i]))*(i-yf_all[9,2*i])
}
print(ytm_9)
rbind(ytm_9)

ytm_9 = c(0.01772235 ,0.01675162,0.01642685, 0.01609891, 0.01617979)

ytm_10 <- list()
for (i in 1: 5){
  ytm_10[i] = ytm_all[10,2*i] + ((ytm_all[10,2*i+1] - ytm_all[10,2*i])/(yf_all[10,2*i+1] - yf_all[10,2*i]))*(i-yf_all[10,2*i])
}
print(ytm_10)
rbind(ytm_10)

ytm_10=c(0.01746137 ,0.01663853, 0.01621016, 0.01585089, 0.0159131)

ytm_result = rbind(ytm_1, ytm_2,ytm_3,ytm_4,ytm_5,ytm_6, ytm_7,ytm_8,ytm_9,ytm_10)
ytm_result

fc_result = rbind(f_1,f_2,f_3,f_4,f_5,f_6,f_7,f_8,f_9,f_10)
fc_result

#Now need to derive the X matrix for yield.

x <- list()
for (j in 1:5){
  for (i in 1:9){
  x[i] = log(ytm_result[i+1,j]/ytm_result[i,j])
  }
  print(x)
}

#21
x1 = c(-0.01792599,-0.003500649,0.007354765,0.005614633,0.001194184,0.01561785,-0.00107196,-0.001165644,-0.01483554)
#22
x2 = c(-0.01584791,-0.00881273,0.006125616,0.002683454,0.01216713,-0.00142508,0.01535373, -0.004435094, -0.00677388)
#23
x3 = c(-0.02104479,-0.01145219,0.005656154,0.002207339,0.01719466,0.006462004,0.008675065,-0.007179443, -0.01327899)
#24
x4 = c(-0.02041206,-0.01584123,0.0229612, -0.01305642,0.02204741,0.008676642,0.001640889, -0.01186861,-0.01552592)
#25
x5 = c(-0.02659563,-0.02931331, 0.01627531, -0.006201383,0.02640665, 0.002577822,-0.001010323, -0.007002095, -0.01662026)

mean(x1)
x1_bar = c(-0.0009687057, -0.0009687057, -0.0009687057,-0.0009687057,-0.0009687057,-0.0009687057,-0.0009687057,-0.0009687057,-0.0009687057)
mean(x2)
x2_bar =c(-0.000107196,-0.000107196,-0.000107196,-0.000107196,-0.000107196,-0.000107196,-0.000107196,-0.000107196,-0.000107196)
mean(x3)
x3_bar = c(-0.001417799,-0.001417799,-0.001417799,-0.001417799,-0.001417799,-0.001417799,-0.001417799,-0.001417799,-0.001417799)
mean(x4)
x4_bar = c(-0.002375344,-0.002375344,-0.002375344,-0.002375344,-0.002375344,-0.002375344,-0.002375344,-0.002375344,-0.002375344)
mean(x5)
x5_bar = c(-0.004609247,-0.004609247,-0.004609247,-0.004609247,-0.004609247,-0.004609247,-0.004609247,-0.004609247,-0.004609247)

x = cbind(x1,x2,x3,x4,x5)
x
x_bar = cbind(x1_bar,x2_bar,x3_bar,x4_bar,x5_bar)

cov_matrix_yield = (t(x - x_bar))%*%(x-x_bar)/8
cov_matrix_yield

eigen(cov_matrix_yield)


# Now let's derive x-matrix for forward.
x <- list()
for (j in 1:4){
  for (i in 1:9){
    x[i] = log(fc_result[i+1,j]/fc_result[i,j])
  }
  print(x)
}

x1 = c(-0.01349884,-0.01479028,0.004711942, -0.000686702, 0.02461116, -0.02090583,0.03412597,-0.008110235, 0.002248943)
x2 = c( -0.02302169, -0.01068764, 0.0004600766, 0.002452177, 0.02629623, -0.001720914, 0.0140071, -0.005740236, -0.01323129)
x3 = c(-0.02299104, -0.02608246,0.02925614, -0.01931709, 0.03056923,0.01058298, 0.002427831, -0.02080732, -0.0162202)
x4 = c(-0.0291687,-0.03700824, 0.01891618,-0.009630243, 0.03373949,-0.001175563, -0.001260529,-0.008673201, -0.01726575)

mean(x1)
x1_bar = c(0.0008562364,0.0008562364,0.0008562364,0.0008562364,0.0008562364,0.0008562364,0.0008562364,0.0008562364,0.0008562364)
mean(x2)
x2_bar =c(-0.00124291,-0.00124291,-0.00124291,-0.00124291,-0.00124291,-0.00124291,-0.00124291,-0.00124291,-0.00124291)
mean(x3)
x3_bar = c(-0.003620214,-0.003620214,-0.003620214,-0.003620214,-0.003620214,-0.003620214,-0.003620214,-0.003620214,-0.003620214)
mean(x4)
x4_bar = c(-0.005725173,-0.005725173,-0.005725173,-0.005725173,-0.005725173,-0.005725173,-0.005725173,-0.005725173,-0.005725173)

x = cbind(x1,x2,x3,x4)
x
x_bar = cbind(x1_bar,x2_bar,x3_bar,x4_bar)

cov_matrix_yield = (t(x - x_bar))%*%(x-x_bar)/8
cov_matrix_yield

eigen(cov_matrix_yield)

